"""Check if a host is in the Google Chrome HSTS Preload list"""

import functools
import os
import typing

__version__ = "2024.2.1"
__checksum__ = "213c5c7568d51f265f12f09f06c7aa12f663ee4e68b5c4692945d2b4abb8a296"
__all__ = ["in_hsts_preload"]

# fmt: off
_GTLD_INCLUDE_SUBDOMAINS = {b'amazon', b'android', b'app', b'audible', b'azure', b'bank', b'bing', b'boo', b'channel', b'chrome', b'dad', b'day', b'dev', b'eat', b'esq', b'fire', b'fly', b'foo', b'gle', b'gmail', b'google', b'hangout', b'hotmail', b'imdb', b'ing', b'insurance', b'kindle', b'meet', b'meme', b'microsoft', b'mov', b'new', b'nexus', b'office', b'page', b'phd', b'play', b'prime', b'prof', b'rsvp', b'search', b'silk', b'skype', b'windows', b'xbox', b'xn--cckwcxetd', b'xn--jlq480n2rg', b'youtube', b'zappos', b'zip'}  # noqa: E501
_JUMPTABLE = [[(0, 11), (11, 5), (16, 19), (35, 55), (90, 26), (116, 12), None, (128, 19), (147, 22), (169, 7), (176, 13), (189, 18), None, (207, 29), (236, 37), (273, 19), (292, 9), (301, 36), (337, 24), (361, 10), (371, 18), None, (389, 62), (451, 8), (459, 22), (481, 19), (500, 13), (513, 14), (527, 14), None, None, (541, 40), (581, 20), (601, 25), (626, 22), (648, 22), (670, 28), None, (698, 15), (713, 25), (738, 8), (746, 13), (759, 10), None, (769, 17), (786, 6), (792, 19), (811, 16), (827, 5), (832, 19), (851, 14), (865, 11), (876, 18), (894, 27), (921, 7), (928, 11), (939, 15), (954, 12), (966, 20), (986, 8), (994, 27), (1021, 46), (1067, 25), (1092, 16), (1108, 8), (1116, 5), (1121, 22), (1143, 18), None, (1161, 36), (1197, 15), (1212, 24), (1236, 11), None, (1247, 5), (1252, 23), (1275, 18), (1293, 18), None, (1311, 20), (1331, 26), (1357, 27), (1384, 28), (1412, 20), (1432, 59), (1491, 14), (1505, 14), (1519, 8), (1527, 8), (1535, 10), (1545, 13), (1558, 20), (1578, 19), None, (1597, 13), (1610, 26), (1636, 11), (1647, 4), (1651, 22), (1673, 10), (1683, 15), (1698, 14), (1712, 28), (1740, 11), (1751, 10), (1761, 12), (1773, 25), None, (1798, 19), (1817, 5), (1822, 26), (1848, 45), (1893, 15), None, (1908, 11), (1919, 30), (1949, 21), (1970, 26), (1996, 6), (2002, 6), (2008, 14), (2022, 5), (2027, 30), (2057, 23), (2080, 6), (2086, 17), (2103, 8), (2111, 12), (2123, 12), (2135, 70), (2205, 55), (2260, 12), (2272, 23), (2295, 16), (2311, 41), None, (2352, 24), (2376, 44), (2420, 6), (2426, 41), (2467, 22), (2489, 23), (2512, 31), (2543, 20), (2563, 8), (2571, 15), (2586, 12), (2598, 32), (2630, 25), (2655, 15), None, (2670, 46), (2716, 21), (2737, 17), (2754, 18), (2772, 26), (2798, 5), (2803, 37), (2840, 39), (2879, 16), (2895, 33), (2928, 17), (2945, 23), (2968, 21), (2989, 25), (3014, 8), (3022, 14), (3036, 7), (3043, 37), None, (3080, 18), (3098, 21), (3119, 20), (3139, 17), (3156, 24), (3180, 12), (3192, 36), (3228, 35), (3263, 12), (3275, 57), (3332, 25), (3357, 32), None, (3389, 8), (3397, 25), (3422, 18), (3440, 6), (3446, 23), None, (3469, 36), (3505, 33), (3538, 14), (3552, 16), (3568, 22), None, (3590, 30), (3620, 41), (3661, 50), (3711, 15), (3726, 20), (3746, 31), (3777, 21), (3798, 32), (3830, 24), (3854, 20), (3874, 17), (3891, 52), (3943, 6), (3949, 9), (3958, 12), (3970, 18), (3988, 11), (3999, 10), (4009, 39), (4048, 42), None, (4090, 36), (4126, 17), None, (4143, 8), (4151, 8), (4159, 7), None, (4166, 25), (4191, 17), None, (4208, 21), (4229, 35), (4264, 21), (4285, 10), (4295, 48), (4343, 11), (4354, 37), (4391, 25), (4416, 19), (4435, 12), (4447, 14), (4461, 23), (4484, 29), (4513, 14), (4527, 8), (4535, 47), (4582, 52), None, None, (4634, 47), (4681, 42), None, (4723, 18), None, (4741, 15), (4756, 8), (4764, 21), (4785, 6), (4791, 29), (4820, 22)], [(4842, 7971), (12813, 7791), (20604, 8172), (28776, 8169), (36945, 7606), (44551, 7795), (52346, 8201), (60547, 7552), (68099, 7775), (75874, 7518), (83392, 8091), (91483, 7100), (98583, 7855), (106438, 8793), (115231, 7851), (123082, 8715), (131797, 8739), (140536, 7280), (147816, 8325), (156141, 7348), (163489, 8109), (171598, 7692), (179290, 7998), (187288, 8379), (195667, 7986), (203653, 7593), (211246, 8441), (219687, 8878), (228565, 7600), (236165, 7757), (243922, 8470), (252392, 8069), (260461, 7862), (268323, 8278), (276601, 7711), (284312, 8475), (292787, 8276), (301063, 8841), (309904, 8332), (318236, 8366), (326602, 8342), (334944, 7406), (342350, 7671), (350021, 7955), (357976, 7586), (365562, 8389), (373951, 7589), (381540, 9069), (390609, 7901), (398510, 7342), (405852, 7851), (413703, 7555), (421258, 7980), (429238, 8101), (437339, 7612), (444951, 7979), (452930, 8136), (461066, 8199), (469265, 7997), (477262, 6694), (483956, 7279), (491235, 8220), (499455, 7931), (507386, 8414), (515800, 8764), (524564, 7643), (532207, 8063), (540270, 8350), (548620, 8902), (557522, 7765), (565287, 7411), (572698, 7439), (580137, 7152), (587289, 8623), (595912, 7720), (603632, 8144), (611776, 7557), (619333, 8790), (628123, 7952), (636075, 7918), (643993, 7960), (651953, 7209), (659162, 7909), (667071, 8084), (675155, 8012), (683167, 8024), (691191, 8537), (699728, 7774), (707502, 7148), (714650, 7867), (722517, 9016), (731533, 8046), (739579, 7643), (747222, 7966), (755188, 7871), (763059, 7844), (770903, 7953), (778856, 7215), (786071, 8286), (794357, 7358), (801715, 7934), (809649, 7487), (817136, 7806), (824942, 7648), (832590, 7706), (840296, 8430), (848726, 8157), (856883, 8099), (864982, 7695), (872677, 7771), (880448, 8610), (889058, 8016), (897074, 7355), (904429, 7562), (911991, 7955), (919946, 7880), (927826, 8003), (935829, 8359), (944188, 7800), (951988, 7974), (959962, 8001), (967963, 7980), (975943, 7507), (983450, 8030), (991480, 8382), (999862, 7590), (1007452, 7726), (1015178, 8651), (1023829, 7702), (1031531, 9065), (1040596, 8646), (1049242, 7618), (1056860, 7556), (1064416, 7324), (1071740, 7754), (1079494, 8620), (1088114, 8578), (1096692, 9128), (1105820, 8284), (1114104, 8220), (1122324, 8849), (1131173, 8362), (1139535, 7626), (1147161, 8044), (1155205, 8698), (1163903, 7114), (1171017, 8110), (1179127, 7674), (1186801, 7886), (1194687, 8060), (1202747, 8023), (1210770, 8075), (1218845, 7992), (1226837, 7451), (1234288, 7745), (1242033, 8176), (1250209, 8043), (1258252, 8036), (1266288, 7647), (1273935, 7236), (1281171, 7553), (1288724, 7961), (1296685, 8060), (1304745, 7681), (1312426, 8277), (1320703, 8475), (1329178, 8367), (1337545, 7529), (1345074, 9122), (1354196, 7881), (1362077, 7795), (1369872, 7989), (1377861, 8552), (1386413, 7467), (1393880, 7529), (1401409, 8185), (1409594, 8325), (1417919, 8336), (1426255, 7561), (1433816, 7384), (1441200, 9724), (1450924, 8453), (1459377, 7498), (1466875, 7925), (1474800, 8142), (1482942, 8154), (1491096, 7199), (1498295, 8468), (1506763, 7993), (1514756, 7999), (1522755, 8036), (1530791, 7381), (1538172, 7708), (1545880, 7185), (1553065, 7911), (1560976, 7243), (1568219, 7201), (1575420, 7348), (1582768, 7803), (1590571, 8203), (1598774, 7891), (1606665, 8008), (1614673, 8358), (1623031, 7218), (1630249, 8332), (1638581, 8281), (1646862, 7503), (1654365, 8240), (1662605, 8915), (1671520, 7495), (1679015, 8694), (1687709, 8069), (1695778, 7798), (1703576, 8089), (1711665, 8184), (1719849, 8123), (1727972, 7797), (1735769, 8130), (1743899, 7708), (1751607, 8564), (1760171, 7820), (1767991, 7327), (1775318, 8563), (1783881, 7962), (1791843, 8232), (1800075, 7528), (1807603, 8387), (1815990, 8290), (1824280, 8282), (1832562, 8710), (1841272, 8512), (1849784, 8056), (1857840, 7875), (1865715, 8256), (1873971, 7720), (1881691, 8887), (1890578, 8014), (1898592, 7305), (1905897, 7484), (1913381, 8422), (1921803, 8505), (1930308, 8287), (1938595, 8301), (1946896, 8015), (1954911, 7618), (1962529, 8637), (1971166, 8124), (1979290, 7939), (1987229, 8066), (1995295, 7072), (2002367, 8056), (2010423, 8106), (2018529, 7903), (2026432, 7532), (2033964, 7930), (2041894, 8127)], [(2050021, 846), (2050867, 716), (2051583, 771), (2052354, 738), (2053092, 802), (2053894, 769), (2054663, 623), (2055286, 891), (2056177, 592), (2056769, 854), (2057623, 485), (2058108, 611), (2058719, 829), (2059548, 922), (2060470, 740), (2061210, 584), (2061794, 1201), (2062995, 610), (2063605, 682), (2064287, 789), (2065076, 1051), (2066127, 700), (2066827, 684), (2067511, 600), (2068111, 689), (2068800, 634), (2069434, 819), (2070253, 1274), (2071527, 730), (2072257, 741), (2072998, 772), (2073770, 672), (2074442, 596), (2075038, 696), (2075734, 974), (2076708, 882), (2077590, 488), (2078078, 779), (2078857, 681), (2079538, 803), (2080341, 734), (2081075, 677), (2081752, 675), (2082427, 801), (2083228, 671), (2083899, 698), (2084597, 630), (2085227, 727), (2085954, 684), (2086638, 456), (2087094, 649), (2087743, 730), (2088473, 706), (2089179, 811), (2089990, 1171), (2091161, 621), (2091782, 729), (2092511, 677), (2093188, 553), (2093741, 600), (2094341, 762), (2095103, 878), (2095981, 936), (2096917, 794), (2097711, 673), (2098384, 694), (2099078, 921), (2099999, 596), (2100595, 558), (2101153, 1021), (2102174, 653), (2102827, 710), (2103537, 396), (2103933, 698), (2104631, 408), (2105039, 650), (2105689, 578), (2106267, 915), (2107182, 771), (2107953, 555), (2108508, 762), (2109270, 725), (2109995, 864), (2110859, 686), (2111545, 769), (2112314, 780), (2113094, 684), (2113778, 572), (2114350, 848), (2115198, 848), (2116046, 1130), (2117176, 1028), (2118204, 896), (2119100, 700), (2119800, 638), (2120438, 438), (2120876, 928), (2121804, 706), (2122510, 762), (2123272, 614), (2123886, 739), (2124625, 699), (2125324, 759), (2126083, 534), (2126617, 780), (2127397, 903), (2128300, 607), (2128907, 571), (2129478, 760), (2130238, 844), (2131082, 766), (2131848, 915), (2132763, 985), (2133748, 679), (2134427, 659), (2135086, 671), (2135757, 706), (2136463, 792), (2137255, 593), (2137848, 640), (2138488, 1049), (2139537, 698), (2140235, 851), (2141086, 708), (2141794, 729), (2142523, 597), (2143120, 809), (2143929, 761), (2144690, 552), (2145242, 892), (2146134, 639), (2146773, 823), (2147596, 597), (2148193, 649), (2148842, 562), (2149404, 860), (2150264, 664), (2150928, 626), (2151554, 628), (2152182, 799), (2152981, 774), (2153755, 650), (2154405, 602), (2155007, 505), (2155512, 707), (2156219, 448), (2156667, 769), (2157436, 637), (2158073, 831), (2158904, 615), (2159519, 742), (2160261, 525), (2160786, 763), (2161549, 860), (2162409, 972), (2163381, 764), (2164145, 788), (2164933, 952), (2165885, 819), (2166704, 682), (2167386, 911), (2168297, 608), (2168905, 774), (2169679, 832), (2170511, 1023), (2171534, 976), (2172510, 522), (2173032, 890), (2173922, 684), (2174606, 602), (2175208, 720), (2175928, 496), (2176424, 958), (2177382, 588), (2177970, 937), (2178907, 787), (2179694, 874), (2180568, 618), (2181186, 628), (2181814, 700), (2182514, 1852), (2184366, 647), (2185013, 674), (2185687, 843), (2186530, 935), (2187465, 626), (2188091, 736), (2188827, 790), (2189617, 556), (2190173, 903), (2191076, 667), (2191743, 578), (2192321, 559), (2192880, 1052), (2193932, 715), (2194647, 658), (2195305, 579), (2195884, 651), (2196535, 822), (2197357, 586), (2197943, 774), (2198717, 695), (2199412, 833), (2200245, 670), (2200915, 625), (2201540, 562), (2202102, 696), (2202798, 947), (2203745, 806), (2204551, 685), (2205236, 757), (2205993, 650), (2206643, 795), (2207438, 1080), (2208518, 500), (2209018, 737), (2209755, 671), (2210426, 751), (2211177, 660), (2211837, 579), (2212416, 668), (2213084, 795), (2213879, 702), (2214581, 1040), (2215621, 523), (2216144, 630), (2216774, 659), (2217433, 698), (2218131, 727), (2218858, 742), (2219600, 784), (2220384, 423), (2220807, 887), (2221694, 552), (2222246, 660), (2222906, 668), (2223574, 816), (2224390, 563), (2224953, 868), (2225821, 836), (2226657, 784), (2227441, 460), (2227901, 793), (2228694, 464), (2229158, 804), (2229962, 538), (2230500, 628), (2231128, 802), (2231930, 595), (2232525, 871), (2233396, 2298), (2235694, 607), (2236301, 757), (2237058, 692), (2237750, 796), (2238546, 646)], [(2239192, 48), None, None, (2239240, 42), None, (2239282, 27), (2239309, 18), None, None, None, None, None, None, None, (2239327, 21), None, None, (2239348, 42), None, (2239390, 25), (2239415, 44), None, (2239459, 49), None, None, None, None, None, None, None, None, None, (2239508, 21), (2239529, 46), None, None, (2239575, 44), None, None, None, None, (2239619, 44), (2239663, 21), (2239684, 23), None, None, None, None, (2239707, 42), None, None, None, None, None, (2239749, 31), None, None, None, None, (2239780, 42), (2239822, 19), None, None, (2239841, 21), None, (2239862, 26), (2239888, 56), None, (2239944, 16), (2239960, 42), (2240002, 27), None, None, None, None, (2240029, 21), (2240050, 52), None, (2240102, 17), (2240119, 20), (2240139, 42), None, None, None, (2240181, 25), (2240206, 17), (2240223, 27), (2240250, 21), None, None, None, (2240271, 24), None, (2240295, 24), (2240319, 21), (2240340, 24), None, (2240364, 48), None, None, (2240412, 17), (2240429, 19), None, None, None, None, None, None, None, None, None, None, None, (2240448, 28), None, (2240476, 64), (2240540, 42), (2240582, 17), (2240599, 17), (2240616, 26), None, (2240642, 19), None, None, None, None, (2240661, 20), None, None, (2240681, 42), (2240723, 63), (2240786, 17), None, None, (2240803, 21), None, None, None, None, (2240824, 21), (2240845, 16), None, (2240861, 31), None, None, None, None, (2240892, 42), None, (2240934, 80), None, (2241014, 9), None, (2241023, 21), (2241044, 42), None, (2241086, 18), (2241104, 65), (2241169, 56), (2241225, 45), None, (2241270, 42), None, None, (2241312, 24), (2241336, 21), None, None, None, None, None, (2241357, 42), (2241399, 21), (2241420, 21), None, (2241441, 42), (2241483, 25), None, (2241508, 40), (2241548, 21), (2241569, 56), None, None, (2241625, 36), None, None, None, (2241661, 16), None, (2241677, 35), None, None, (2241712, 21), None, (2241733, 22), (2241755, 21), (2241776, 21), (2241797, 21), None, (2241818, 63), (2241881, 41), (2241922, 21), (2241943, 42), None, None, None, None, None, (2241985, 15), (2242000, 21), (2242021, 21), None, None, (2242042, 21), None, None, (2242063, 21), None, None, (2242084, 19), (2242103, 66), None, None, None, (2242169, 50), None, (2242219, 21), (2242240, 21), (2242261, 19), None, None, (2242280, 26), None, (2242306, 39), (2242345, 42), None, None, None, None, None, None, (2242387, 21), None, None, None, (2242408, 21), None, None, (2242429, 64), None, (2242493, 254), (2242747, 21), (2242768, 24), None, (2242792, 21), (2242813, 14)], [None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, (2242827, 62), None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None]]  # noqa: E501
_CRC8_TABLE = [
    0x00, 0x07, 0x0e, 0x09, 0x1c, 0x1b, 0x12, 0x15,
    0x38, 0x3f, 0x36, 0x31, 0x24, 0x23, 0x2a, 0x2d,
    0x70, 0x77, 0x7e, 0x79, 0x6c, 0x6b, 0x62, 0x65,
    0x48, 0x4f, 0x46, 0x41, 0x54, 0x53, 0x5a, 0x5d,
    0xe0, 0xe7, 0xee, 0xe9, 0xfc, 0xfb, 0xf2, 0xf5,
    0xd8, 0xdf, 0xd6, 0xd1, 0xc4, 0xc3, 0xca, 0xcd,
    0x90, 0x97, 0x9e, 0x99, 0x8c, 0x8b, 0x82, 0x85,
    0xa8, 0xaf, 0xa6, 0xa1, 0xb4, 0xb3, 0xba, 0xbd,
    0xc7, 0xc0, 0xc9, 0xce, 0xdb, 0xdc, 0xd5, 0xd2,
    0xff, 0xf8, 0xf1, 0xf6, 0xe3, 0xe4, 0xed, 0xea,
    0xb7, 0xb0, 0xb9, 0xbe, 0xab, 0xac, 0xa5, 0xa2,
    0x8f, 0x88, 0x81, 0x86, 0x93, 0x94, 0x9d, 0x9a,
    0x27, 0x20, 0x29, 0x2e, 0x3b, 0x3c, 0x35, 0x32,
    0x1f, 0x18, 0x11, 0x16, 0x03, 0x04, 0x0d, 0x0a,
    0x57, 0x50, 0x59, 0x5e, 0x4b, 0x4c, 0x45, 0x42,
    0x6f, 0x68, 0x61, 0x66, 0x73, 0x74, 0x7d, 0x7a,
    0x89, 0x8e, 0x87, 0x80, 0x95, 0x92, 0x9b, 0x9c,
    0xb1, 0xb6, 0xbf, 0xb8, 0xad, 0xaa, 0xa3, 0xa4,
    0xf9, 0xfe, 0xf7, 0xf0, 0xe5, 0xe2, 0xeb, 0xec,
    0xc1, 0xc6, 0xcf, 0xc8, 0xdd, 0xda, 0xd3, 0xd4,
    0x69, 0x6e, 0x67, 0x60, 0x75, 0x72, 0x7b, 0x7c,
    0x51, 0x56, 0x5f, 0x58, 0x4d, 0x4a, 0x43, 0x44,
    0x19, 0x1e, 0x17, 0x10, 0x05, 0x02, 0x0b, 0x0c,
    0x21, 0x26, 0x2f, 0x28, 0x3d, 0x3a, 0x33, 0x34,
    0x4e, 0x49, 0x40, 0x47, 0x52, 0x55, 0x5c, 0x5b,
    0x76, 0x71, 0x78, 0x7f, 0x6a, 0x6d, 0x64, 0x63,
    0x3e, 0x39, 0x30, 0x37, 0x22, 0x25, 0x2c, 0x2b,
    0x06, 0x01, 0x08, 0x0f, 0x1a, 0x1d, 0x14, 0x13,
    0xae, 0xa9, 0xa0, 0xa7, 0xb2, 0xb5, 0xbc, 0xbb,
    0x96, 0x91, 0x98, 0x9f, 0x8a, 0x8d, 0x84, 0x83,
    0xde, 0xd9, 0xd0, 0xd7, 0xc2, 0xc5, 0xcc, 0xcb,
    0xe6, 0xe1, 0xe8, 0xef, 0xfa, 0xfd, 0xf4, 0xf3
]
# fmt: on

_IS_LEAF = 0x80
_INCLUDE_SUBDOMAINS = 0x40


try:
    from importlib.resources import open_binary

    def open_pkg_binary(path: str) -> typing.BinaryIO:
        return open_binary("hstspreload", path)


except ImportError:

    def open_pkg_binary(path: str) -> typing.BinaryIO:
        return open(
            os.path.join(os.path.dirname(os.path.abspath(__file__)), path),
            "rb",
        )


@functools.lru_cache(maxsize=1024)
def in_hsts_preload(host: typing.AnyStr) -> bool:
    """Determines if an IDNA-encoded host is on the HSTS preload list"""

    if isinstance(host, str):
        host = host.encode("ascii")
    labels = host.lower().split(b".")

    # Fast-branch for gTLDs that are registered to preload all sub-domains.
    if labels[-1] in _GTLD_INCLUDE_SUBDOMAINS:
        return True

    with open_pkg_binary("hstspreload.bin") as f:
        for layer, label in enumerate(labels[::-1]):
            # None of our layers are greater than 5 deep.
            if layer > 4:
                return False

            # Read the jump table for the layer and label
            jump_info = _JUMPTABLE[layer][_crc8(label)]
            if jump_info is None:
                # No entry: host is not preloaded
                return False

            # Read the set of entries for that layer and label
            f.seek(jump_info[0])
            data = bytearray(jump_info[1])
            f.readinto(data)

            for is_leaf, include_subdomains, ent_label in _iter_entries(data):
                # We found a potential leaf
                if is_leaf:
                    if ent_label == host:
                        return True
                    if include_subdomains and host.endswith(b"." + ent_label):
                        return True

                # Continue traversing as we're not at a leaf.
                elif label == ent_label:
                    break
            else:
                return False
    return False


def _iter_entries(data: bytes) -> typing.Iterable[typing.Tuple[int, int, bytes]]:
    while data:
        flags = data[0]
        size = data[1]
        label = bytes(data[2 : 2 + size])
        yield (flags & _IS_LEAF, flags & _INCLUDE_SUBDOMAINS, label)
        data = data[2 + size :]


def _crc8(value: bytes) -> int:
    # CRC8 reference implementation: https://github.com/niccokunzmann/crc8
    checksum = 0x00
    for byte in value:
        checksum = _CRC8_TABLE[checksum ^ byte]
    return checksum
